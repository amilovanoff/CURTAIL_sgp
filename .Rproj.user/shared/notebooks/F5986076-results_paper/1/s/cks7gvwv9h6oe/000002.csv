"0","modelframework::load_input_data_f()"
"0","res <- do.call(transport_lca_ghg_f,list())"
"0","dt <- subset(res[[""transport_lca_ghg_process""]],Year%in%c(2005,2019) & Value!=0 & Process!=""CNG"") #REMOVE CNG "
"0","#Format"
"0","dt$Mode <- rename_values(dt$Mode,list(""Rapid transit""=c(""LRT"",""MRT""),""Bus""=c(""Public bus"",""School bus"",""Private bus""),""Private car""=c(""Private car"",""Private hire car"")))"
"0","dt$Process[dt$Process%in%c(""Vehicle production, without battery"",""Battery production"",""Bus production, without battery"",""Motorcycle production, without battery"")] <- """""
"0","dt$Phase <- rename_values(dt$Phase,list("" prod.""=c(""Fuel Production""),"" use""=c(""Fuel Use""),""Vehicle prod.""=c(""Vehicle production"")))"
"0","dt$Category <- sapply(1:nrow(dt),function(x)paste0(dt$Process[x],dt$Phase[x]))"
"0","#Discard non-relevant columns"
"0","dt <- subset(dt,select=c(Year,Category,Value,Mode))"
"0","#Total"
"0","plot_tot <- aggregate(formula = Value~Year+Category,data = dt,FUN=sum)"
"0","#"
"0","dt$Value <- sapply(1:nrow(dt),function(x)dt$Value[x]/sum(subset(dt,Mode==dt$Mode[x] & Year==dt$Year[x])$Value))"
"0","plot_tot$Value <- sapply(1:nrow(plot_tot),function(x)plot_tot$Value[x]/sum(subset(plot_tot,Year==plot_tot$Year[x])$Value))"
"0","plot_tot$Mode <- ""TOTAL"""
"0",""
"0","#Combine"
"0","plot_col <- rbind(dt,plot_tot)"
"0","plot_col$Mode <- factor(plot_col$Mode,levels=rev(c(""Rapid transit"",""Bus"",""Taxi"",""Motorcycle"",""Private car"",""TOTAL"")))"
"0","plot_col$Category <- factor(plot_col$Category,levels=c(""Diesel prod."",""Diesel use"",""Gasoline prod."",""Gasoline use"",""Electricity prod."",""Vehicle prod.""))"
"0",""
"0","ggplot(data=subset(plot_col))+"
"0","  geom_col(aes(x=Mode,y=Value*100,fill=Category))+"
"0","  geom_segment(aes(x=""TOTAL"",xend=""TOTAL"",yend=100,y=-50),"
"0","               position = position_nudge(x = 0.5, y = 0),"
"0","               lineend = ""square"","
"0","               size=1)+"
"0","  facet_wrap(~Year,nrow=2)+"
"0","  guides(fill = guide_legend(title=NULL,ncol=2))+"
"0","  coord_flip(clip=""off"",ylim=c(0,100))+"
"0","  scale_fill_manual(values=c(""#A6CEE3"",""#1F78B4"",""#FB9A99"",""#E31A1C"",""#d8b365"",""#bdbdbd"",""#636363"",""#000000""))+"
"0","  scale_y_continuous(expand = c(0.01,0),labels = paste0(seq(0,100,25),""%""))+"
"0","  scale_x_discrete(expand = c(0.01,0))+"
"0","  labs(y=""Stage contribution analysis"",x=NULL)+"
"0","  theme_milovanoff(axis.title.x=element_text(hjust=1,face=""plain"",margin = unit(c(0,0,0,0),""mm"")),"
"0","                   legend_position = ""bottom"","
"0","                   legend.key.height = unit(0.4, ""cm""),"
"0","                   legend.key.width = unit(0.4, ""cm""),"
"0","                   legend.margin = margin(t=-0.2,r=0.5,b=0.1,l=-0.5, ""cm""),"
"0","                   plot.margin=unit(c(0,5,0,2),""mm""),"
"0","                   strip.text = element_text(face=""bold"",size=rel(0.8),margin = unit(c(0,0,0,0),""mm"")))"
