"0","res <- read_def_outputs_f(function_tbc=""transport_veh_pop_f"",scen_tbc=""scen1"")"
"0",""
"0","#Vehicle stock"
"0","years_tbc <- c(2020:2050)"
"0","#Technology order"
"0","car_techno_order <- c(""ICEV-G"",""ICEV-D"",""HEV-G"",""HEV-D"",""CNG"",""PHEV"",""BEV"")"
"0","moto_techno_order <- c(""ICEM-G"",""EM"")"
"0","bus_techno_order <- c(""ICEB-G"",""ICEB-D"",""HEB-G"",""HEB-D"",""CNGB"",""EB"")"
"0","#Color by technology"
"0","color_car <- c(""ICEV-G""=""#1f78b4"",""ICEV-D""=""#d95f02"",""HEV-G""=""#a6cee3"",""HEV-D""=""#fdbf6f"",""CNG""=""#bebada"",""PHEV""=""#b2df8a"",""BEV""=""#33a02c"")"
"0","color_moto <- c(""ICEM-G""=""#1f78b4"",""EM""=""#33a02c"")"
"0","color_bus <- c(""ICEB-G""=""#1f78b4"",""ICEB-D""=""#d95f02"",""HEB-G""=""#a6cee3"",""HEB-D""=""#fdbf6f"",""CNGB""=""#bebada"",""EB""=""#33a02c"")"
"0",""
"0","for (scen in c(""PC_EV"",""PT_EV"")){"
"0","  dt <- subset(res[[""transport_vint_veh_pop_dt""]],Scenario==scen & Year%in%years_tbc)"
"0","  for (mode in c(""Taxi"",""Public bus"",""Private car"")){"
"0","    #Techno order"
"0","    color_value_name <- switch(mode,"
"0","                                `Private car`=""color_car"","
"0","                                `Private hire car`=""color_car"","
"0","                                `Taxi`=""color_car"","
"0","                                Motorcycle = ""color_moto"","
"0","                                `Public bus` = ""color_bus"","
"0","                                `Private bus` = ""color_bus"","
"0","                                `School bus` = ""color_bus"")"
"0","    color_values <- get(color_value_name)"
"0","    #Color"
"0","    techno_order_name <- switch(mode,"
"0","                                `Private car`=""car_techno_order"","
"0","                                `Private hire car`=""car_techno_order"","
"0","                                `Taxi`=""car_techno_order"","
"0","                                Motorcycle = ""moto_techno_order"","
"0","                                `Public bus` = ""bus_techno_order"","
"0","                                `Private bus` = ""bus_techno_order"","
"0","                                `School bus` = ""bus_techno_order"")"
"0","    techno_order <- get(techno_order_name)"
"0","    "
"0","    #Vehicle stock"
"0","    plot_dt <- subset(dt,Mode==mode)"
"0","    plot_dt$Technology <- factor(plot_dt$Technology, levels=techno_order)"
"0","    "
"0","    plot <- ggplot(data=plot_dt)+"
"0","      geom_col(aes(x=Year,y=Value/10^3,fill=Technology))+"
"0","      facet_wrap(~Mode)+"
"0","      scale_fill_manual(values=color_values)+"
"0","      scale_y_continuous(expand = c(0.01,0))+"
"0","      scale_x_continuous(expand = c(0.01,0))+"
"0","      labs(x=NULL,y=""Vehicle population \n (thousand vehicles)"")+"
"0","      theme_milovanoff()"
"0","    "
"0","    ggsave(paste0(""outputs/plots/si/proj_stock_techno_"",mode,""_"",scen,"".png""),plot+theme(legend.position = ""none""),width=3,height=2.5,units=c(""in""),dpi=600)"
"0","  }"
"0","}"
"0",""
"0","#Get legend"
"0","#Plot legend"
"0","plot_w_leg <- plot + "
"0","  guides(fill=guide_legend(nrow=1,title = NULL)) + "
"0","  scale_fill_manual(values=color_values,labels=c(""ICEV-G""=""ICEV-G"",""ICEV-D""=""ICEV-D"",""HEV-G""=""HEV-G"",""HEV-D""=""HEV-D"",""CNG"",""PHEV"",""BEV""))"
"0","plot_legend_colour <- get_legend(plot_w_leg)"
"0","ggsave(""outputs/plots/si/proj_stock_techno_leg.png"",plot=plot_legend_colour,width=6,height=0.3,units=c(""in""),dpi=600)"
"0",""
"0","#Calculate numerical values"
"0","#Cumulative production of EVs, EB"
"0","dt <- subset(res[[""transport_vint_veh_pop_dt""]],Year%in%years_tbc & Technology%in%c(""BEV"",""EB"",""EM"") & Age==0) %>%"
"0","  aggregate(formula = Value~Technology+Year++Scenario,data = .,FUN=sum) %>%"
"0","  cum_long_dtf_f(.) %>%"
"0","  subset(.,Year==2050)"
"0","  "
"0",""
"0",""
